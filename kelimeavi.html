<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kelime Avı - Türkçe</title>
    <!-- Modern ve Türkçe karakter destekli font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
    <!-- Font Awesome ikonları için -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Tone.js Ses Kütüphanesi -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        :root {
            --primary-color: #1a237e; /* Başlık için daha koyu renk */
            --secondary-color: #feb47b;
            --text-color: #333;
            --grid-bg: rgba(255, 255, 255, 0.7);
            --cell-border: #ccc;
            --found-color: #8bc34a;
            --unfound-color: #9b59b6;
            --wrong-color: #ff4d4d;
            --selected-color: #ffc107;
            --hint-color: #ff69b4; /* Yeni pembe ipucu rengi */
            --button-bg: #4caf50;
            --button-text: #fff;
            --modal-bg: rgba(0, 0, 0, 0.7);
            --modal-content-bg: #fff;
        }
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Poppins', sans-serif;
            background-color: #fdf5e6; /* Resme uygun açık krem renk */
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .container-wrapper {
            width: 100%;
            height: 100%;
            max-width: 1024px;
            max-height: 768px;
            display: flex;
            flex-direction: column;
            padding: 10px;
            gap: 10px;
            box-sizing: border-box;
            background: url('https://www.shutterstock.com/shutterstock/photos/2018006504/display_1500/stock-photo-fresh-red-and-green-apples-on-wooden-table-and-on-tree-branches-autumn-and-harvest-concept-apple-2018006504.jpg') center/cover no-repeat;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        .title {
            text-align: center;
            color: var(--primary-color);
            text-shadow: 2px 2px 4px #fff; /* Daha belirgin beyaz gölge */
            margin: 0;
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            animation: bounceIn 1s ease-out;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            animation: fadeIn 1s ease-in;
        }
        .controls label, .controls button {
            font-size: clamp(0.8rem, 2vw, 1rem);
            padding: 8px 12px;
            border-radius: 8px;
        }
        .controls select, .controls input {
            border: 1px solid var(--cell-border);
            border-radius: 8px;
        }
        .controls button {
            cursor: pointer;
            border: none;
            color: var(--button-text);
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 6px 12px rgba(0,0,0,0.3); /* Daha güçlü kutu gölgesi */        }

        .controls .start-btn { background: var(--button-bg); }
        .controls .check-btn { background: #3498db; }
        .controls .hint-btn { background: #f39c12; }
        .controls .reset-btn { background: #2c3e50; }
        .controls .how-to-btn { background: #9b59b6; }
        .controls .show-answers-btn { background: #e74c3c; }
        .controls button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.4); /* Hover'da daha da güçlü gölge */
        }
        .status-area {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            font-size: clamp(0.9rem, 2.5vw, 1.2rem);
            color: var(--text-color);
            margin-bottom: 10px;
            animation: fadeIn 1.2s ease-in;
        }
        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .main-content {
            display: flex;
            flex: 1;
            width: 100%;
            gap: 20px;
            justify-content: center;
            align-items: flex-start;
            overflow: hidden;
            background-color: rgba(255, 255, 255, 0.3); /* Arka planı biraz saydam yap */
            backdrop-filter: blur(5px); /* Arka planı bulanıklaştır */
            border-radius: 12px;
            padding: 10px;
        }
        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
            width: 100%;
            max-width: 60%;
        }
        .grid-container {
            display: grid;
            touch-action: none;
            background: var(--grid-bg);
            border: 2px solid var(--cell-border);
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .cell {
            background: rgba(255, 255, 255, 0.7);
            font-weight: bold;
            text-align: center;
            border: 1px solid var(--cell-border);
            box-sizing: border-box;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 4px;
            font-size: clamp(14px, 4vw, 28px);
            aspect-ratio: 1;
            opacity: 0;
            animation: cellFadeIn 0.5s ease forwards;
        }        
        .cell:hover:not(.found):not(.unfound-answer) {
            transform: scale(1.05);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .cell.selected {
            background: var(--selected-color);
            color: #fff;
        }
        .cell.found {
            background: var(--found-color);
            color: #fff;
            text-decoration: none;
            opacity: 1;
            transition: background 0.3s, color 0.3s;
        }
        .cell.unfound-answer {
            background: var(--unfound-color);
            color: #fff;
            pointer-events: none;
            text-decoration: none;
            opacity: 1;
            transition: background 0.3s, color 0.3s;
        }        
        .cell.correct-highlight {
            background: var(--found-color);
            animation: correctFlash 0.5s;
        }        
        /* Yanlış kelime için yeni vurgulama animasyonu */
        .cell.wrong-highlight {
            animation: wrongFlash 0.5s ease-in-out;
        }
        /* Yeni ipucu vurgulama animasyonu */
        .cell.hint-highlight {
            animation: hintFlash 0.8s ease-in-out;
            color: #fff;
            background: var(--hint-color); /* Pembe renk */
        }        
        .word-list-area {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
            max-width: 35%;
            overflow-y: auto;
            max-height: 100%;
            padding: 10px;
            box-sizing: border-box;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .word-list-area .word-item {
            background: #e0e0e0;
            padding: 6px 10px;
            border-radius: 6px;
            transition: all 0.3s;
            font-size: clamp(0.9rem, 2.5vw, 1.1rem);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-direction: column;
            text-align: left;
        }
        .word-list-area .word-item.found {
            background: var(--found-color);
            color: #fff;
        }        
        .word-list-area .word-item.unfound-answer {
            background: var(--unfound-color);
            color: #fff;
        }        
        .word-item-description {
            font-size: clamp(0.8rem, 2vw, 1rem);
            color: #666;
        }
        .word-item.found .word-item-description,
        .word-item.unfound-answer .word-item-description {
            color: #fff;
        }        
        .found-word-text {
            font-weight: bold;
            color: var(--found-color);
        }
        .unfound-word-text {
            font-weight: bold;
            color: var(--unfound-color);
        }
        .word-item.found .found-word-text,
        .word-item.unfound-answer .unfound-word-text {
            color: #fff;
        }
                .selected-word {
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            font-weight: bold;
            color: var(--primary-color);
        }
                .progress-bar-container {
            width: 80%;
            height: 15px;
            background: #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 10px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        .progress-bar {
            height: 100%;
            width: 0;
            background: linear-gradient(to right, var(--found-color), #4CAF50);
            border-radius: 8px;
            transition: width 0.5s ease;
        }
        /* Modal */
        .modal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--modal-bg);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
            animation: fadeIn 0.3s ease;
        }
        .modal-content {
            background-color: var(--modal-content-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 80%;
            max-height: 80%;
            overflow-y: auto;
            transform: scale(0.9);
            animation: scaleUp 0.3s ease forwards;
        }
        .modal-title {
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        /* Adjusted font sizes for the modal message */
        .modal-message {
            font-size: clamp(0.9rem, 2.5vw, 1.2rem);
            margin-bottom: 20px;
            line-height: 1.5;
            text-align: left;
            padding: 0 10px;
        }
        .modal-message ul {
            text-align: left;
            padding-left: 20px;
            margin: 0;
        }
        .modal-message li {
            margin-bottom: 8px;
        }
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        .modal-buttons button {
            padding: 10px 20px;
            font-size: clamp(0.9rem, 2.5vw, 1.1rem);
            border-radius: 8px;
            border: none;
            cursor: pointer;
            color: #fff;
            font-weight: bold;
            transition: transform 0.2s;
        }
        .modal-buttons button:hover { transform: scale(1.05); }

        .modal-buttons .play-again { background: var(--button-bg); }
        .modal-buttons .show-answers { background: #e74c3c; }
        .modal-buttons .close-modal { background: #95a5a6; }
        
        .word-answers {
            text-align: left;
            margin-top: 15px;
        }
        .word-answers strong { color: var(--primary-color); }
        .word-answers ul {
            list-style: none;
            padding: 0;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin: 0;
        }
        .word-answers li {
            background: var(--found-color);
            color: #fff;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: clamp(0.8rem, 2vw, 1rem);
        }        
        /* Tema geçişleri */
        @media (max-width: 768px) {
            .container-wrapper {
                max-width: 100%;
                max-height: 100%;
                border-radius: 0;
            }
            .main-content {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            .game-area, .word-list-area {
                max-width: 95%;
            }
            .game-area { order: 1; }
            .word-list-area { order: 2; }
            .controls, .status-area {
                gap: 8px;
            }
        }
        
        /* Animasyonlar */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes bounceIn {
            0%, 20%, 40%, 60%, 80%, 100% {
                transition-timing-function: cubic-bezier(0.215, 0.610, 0.355, 1.000);
            }            0% { opacity: 0; transform: scale3d(0.3, 0.3, 0.3); }
            20% { transform: scale3d(1.1, 1.1, 1.1); }
            40% { transform: scale3d(0.9, 0.9, 0.9); }
            60% { opacity: 1; transform: scale3d(1.03, 1.03, 1.03); }
            80% { transform: scale3d(0.97, 0.97, 0.97); }
            100% { opacity: 1; transform: scale3d(1, 1, 1); }
        }
        @keyframes cellFadeIn {
            to { opacity: 1; }
        }
        @keyframes correctFlash {
            0% { background-color: var(--found-color); }
            50% { background-color: #fff; }
            100% { background-color: var(--found-color); }
        }
        /* Yeni yanlış kelime animasyonu: Kırmızıya döner ve hızlıca eski haline gelir */
        @keyframes wrongFlash {
            0% { background-color: rgba(255, 255, 255, 0.7); color: var(--text-color); }
            50% { background-color: var(--wrong-color); color: #fff; }
            100% { background-color: rgba(255, 255, 255, 0.7); color: var(--text-color); }
        }
        /* Yeni ipucu animasyonu: Pembe renkte parlayıp sönme */
        @keyframes hintFlash {
            0% { background-color: rgba(255, 255, 255, 0.7); color: var(--text-color); }
            50% { background-color: var(--hint-color); color: #fff; }
            100% { background-color: rgba(255, 255, 255, 0.7); color: var(--text-color); }
        }
        @keyframes scaleUp {
            from { transform: scale(0.8); }
            to { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container-wrapper">
        <h1 class="title">Kelime Avı 🇹🇷</h1>
        <div class="controls" id="game-controls">
            <button id="startBtn" class="start-btn">Başlat</button>
            <button id="hintBtn" class="hint-btn" style="display:none;"><i class="fa-solid fa-lightbulb"></i> İpucu</button>
            <button id="resetBtn" class="reset-btn" style="display:none;"><i class="fa-solid fa-sync-alt"></i> Sıfırla</button>
            <button id="howToBtn" class="how-to-btn"><i class="fa-solid fa-question"></i> Nasıl Yapılır?</button>
        </div>
        <div class="status-area" id="game-status" style="display:none;">
            <div class="status-item"><i class="fa-solid fa-clock"></i> Süre: <span id="timer">120</span>s</div>
            <div class="status-item"><i class="fa-solid fa-trophy"></i> Doğru: <span id="score">0</span></div>
            <div class="status-item"><i class="fa-solid fa-book"></i> Kalan: <span id="remaining">0</span></div>
        </div>
        
        <div class="main-content">
            <div class="game-area">
                <div class="grid-container" id="grid"></div>
                <div class="selected-word" id="selectedWord">Seçilen: </div>
                <div class="progress-bar-container" style="display:none;">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
            </div>
            <div class="word-list-area" id="wordList" style="display:none;"></div>
        </div>
    </div>
    
    <!-- Modals -->
    <div id="howToModal" class="modal">
        <div class="modal-content">
            <h2 class="modal-title">Nasıl Yapılır?</h2>
            <div class="modal-message">
                <p>Kelime Avı'na hoş geldiniz! Amacınız, verilen süre içinde ızgarada saklı olan tüm kelimeleri bulmak. İşte adım adım nasıl oynayacağınız:</p>
                <ul>
                    <li><strong>Kelime Seçimi:</strong> Farenizle veya parmağınızla bir harfe tıklayıp basılı tutun ve kelimenin devamını oluşturan harflerin üzerinden sürükleyin.</li>
                    <li><strong>Otomatik Kontrol:</strong> Sürükleme işlemini bitirip fareyi veya parmağınızı kaldırdığınız anda, seçtiğiniz kelime otomatik olarak kontrol edilir.</li>
                    <li><strong>Geri Bildirim:</strong> Bulduğunuz kelime doğruysa harfler yeşil renge döner ve bulmacada kalır. Yanlışsa, harfler kısa bir süre kırmızı olur ve normale döner.</li>
                    <li><strong>Kelime Yönleri:</strong> Kelimeler yatay (sağdan sola, soldan sağa) ve dikey (yukarıdan aşağıya, aşağıdan yukarıya) yönlerde gizlenmiş olabilir.</li>
                    <li><strong>İpucu Butonu:</strong> Eğer takılırsanız, ipucu butonuna tıklayabilirsiniz. Bu buton, bulunmamış bir kelimenin ilk harfini kısa süreliğine vurgulayarak size yol gösterir.</li>
                    <li><strong>Sıfırla Butonu:</strong> Bu butona tıkladığınızda mevcut oyunu sonlandırıp yeni bir oyun başlatabilirsiniz.</li>
                    <li><strong>Kelime Listesi:</strong> Sağ taraftaki listede kelimelerin açıklamalarını görebilirsiniz. Bir kelimeyi doğru bulduğunuzda, açıklamanın yanına kelimenin kendisi eklenecektir.</li>
                </ul>
            </div>
            <div class="modal-buttons">
                <button class="close-modal">Kapat</button>
            </div>
        </div>
    </div>

    <div id="endGameModal" class="modal">
        <div class="modal-content">
            <h2 class="modal-title" id="endGameTitle"></h2>
            <p class="modal-message" id="endGameMessage"></p>
            <div class="modal-buttons">
                <button class="play-again">Tekrar Dene</button>
                <button class="show-answers" style="display:none;">Cevapları Göster</button>
            </div>
        </div>
    </div>
    
    <script>
        // DOM elementlerini seçme
        const startBtn = document.getElementById("startBtn");
        const hintBtn = document.getElementById("hintBtn");
        const resetBtn = document.getElementById("resetBtn");
        const howToBtn = document.getElementById("howToBtn");
        const timerEl = document.getElementById("timer");
        const scoreEl = document.getElementById("score");
        const remainingEl = document.getElementById("remaining");
        const gridEl = document.getElementById("grid");
        const listEl = document.getElementById("wordList");
        const selEl = document.getElementById("selectedWord");
        const progressBar = document.getElementById("progressBar");

        // Modal'lar ve butonları
        const howToModal = document.getElementById("howToModal");
        const endGameModal = document.getElementById("endGameModal");
        const endGameTitle = document.getElementById("endGameTitle");
        const endGameMessage = document.getElementById("endGameMessage");
        const modalPlayAgainBtn = endGameModal.querySelector(".play-again");
        const modalShowAnswersBtn = endGameModal.querySelector(".show-answers");
        const howToModalCloseBtn = howToModal.querySelector(".close-modal");

        // Tone.js ses synthlerini başlatma
        const correctSynth = new Tone.Synth().toDestination();
        const wrongSynth = new Tone.Synth().toDestination();
        const winSynth = new Tone.PolySynth(Tone.Synth).toDestination();
        const warningSynth = new Tone.Synth().toDestination();
        const hintSynth = new Tone.Synth().toDestination();

        // Oyun durumu değişkenleri
        let gridSize;
        let grid = [];
        let timeLeft;
        let timerId;
        let wordsToPlace = [];
        let currentSelection = [];
        let foundWords = [];
        let score = 0;
        let isSelecting = false;
        let hintTimer = null;
        let wordDescriptions = {};
        let wordPositions = {};
        let cellFoundStatus = {};

        // Kelime bankaları
        const wordBanks = {
            medium: ["ÇİLEK", "LİMON", "KAVUN", "KİVİ", "ANANAS", "MANDALİNA", "KARPUZ", "VİŞNE"]
        };
        
        // Kelime açıklamaları
        const wordDescriptionsMedium = {
            "ÇİLEK": "Yaz aylarında yenilen, kalp şeklinde kırmızı bir meyve.",
            "LİMON": "Ekşi tadıyla bilinen, C vitamini açısından zengin sarı meyve.",
            "KAVUN": "İç kısmı turuncu veya yeşil, tatlı ve sulu bir yaz meyvesi.",
            "KİVİ": "Tüylü, kahverengi kabuklu ve içi yeşil, minik siyah çekirdekli meyve.",
            "ANANAS": "Tropikal bir meyve, dışı sert kabuklu ve iç kısmı tatlı.",
            "MANDALİNA": "Kışın tüketilen, kolay soyulabilen, küçük ve tatlı bir narenciye.",
            "KARPUZ": "Sıcak yaz günlerinde serinleten, içi kırmızı ve sulu dev meyve.",
            "VİŞNE": "Kiraza benzeyen, ama tadı daha ekşi olan küçük kırmızı meyve."
        };
        
        // Yönler (dikey, yatay)
        const directions = [
            {r: 0, c: 1},  // Sağa
            {r: 0, c: -1}, // Sola
            {r: 1, c: 0},  // Aşağı
            {r: -1, c: 0}  // Yukarı
        ];

        /**
         * Oyunu baştan başlatır.
         */
        function startGame() {
            // Önceki modalı ve zamanlayıcıyı temizle
            hideModal(endGameModal);
            clearInterval(timerId);
            // Oyun değişkenlerini sıfırla
            currentSelection = [];
            foundWords = [];
            score = 0;
            isSelecting = false;
            wordPositions = {};
            cellFoundStatus = {};            
            // Oyun seviyesi ve süreyi ayarla
            gridSize = 10;
            wordsToPlace = [...wordBanks.medium];
            wordDescriptions = wordDescriptionsMedium;
            timeLeft = 120;
            // Arayüzü güncelle
            scoreEl.textContent = score;
            remainingEl.textContent = wordsToPlace.length - foundWords.length;
            timerEl.textContent = timeLeft;
            document.getElementById("game-controls").style.display = "flex";
            document.getElementById("game-status").style.display = "flex";
            document.querySelector(".progress-bar-container").style.display = "block";
            listEl.style.display = "flex";
            startBtn.style.display = "none";
            hintBtn.style.display = "inline-block";
            resetBtn.style.display = "inline-block";
            modalShowAnswersBtn.style.display = "none";
            updateProgressBar();            
            generateGrid();
            startTimer();
        }

        /**
         * Zamanlayıcıyı başlatır.
         */
        function startTimer() {
            timerId = setInterval(() => {
                timeLeft--;
                timerEl.textContent = timeLeft;
                if (timeLeft <= 10) {
                    if (timeLeft > 0 && timeLeft % 2 === 0) {
                        warningSynth.triggerAttackRelease("C4", "8n");
                    }
                    if (timeLeft === 0) {
                        clearInterval(timerId);
                        endGame(false); // Süre bitti
                    }                }
            }, 1000);
        }

        /**
         * Izgarayı ve kelimeleri oluşturur.
         */
        function generateGrid() {
            grid = Array(gridSize).fill().map(() => Array(gridSize).fill(""));
            
            wordsToPlace.forEach(word => placeWord(word));
            
            for (let r = 0; r < gridSize; r++) {
                for (let c = 0; c < gridSize; c++) {
                    if (grid[r][c] === "") {
                        grid[r][c] = "ABCÇDEFGĞHIİJKLMNOÖPRSŞTUÜVYZ"[Math.floor(Math.random() * 29)];
                    }
                }
            }
            buildGridUI();
        }

        /**
         * Tek bir kelimeyi ızgaraya yerleştirir.
         * @param {string} word - Yerleştirilecek kelime
         */
        function placeWord(word) {
            let placed = false;
            let tries = 0;
            while (!placed && tries < 200) {
                tries++;
                const dir = directions[Math.floor(Math.random() * directions.length)];
                
                const startRow = Math.floor(Math.random() * gridSize);
                const startCol = Math.floor(Math.random() * gridSize);
                
                let canPlace = true;
                const path = [];
                for (let i = 0; i < word.length; i++) {
                    const r = startRow + i * dir.r;
                    const c = startCol + i * dir.c;
                    
                    if (r < 0 || r >= gridSize || c < 0 || c >= gridSize || (grid[r][c] !== "" && grid[r][c] !== word[i])) {
                        canPlace = false;
                        break;
                    }
                    path.push([r, c]);
                }
                
                if (canPlace) {
                    path.forEach(([r, c], i) => grid[r][c] = word[i]);
                    wordPositions[word] = { startRow, startCol, dir };
                    placed = true;
                }
            }
        }

        /**
         * Izgara arayüzünü oluşturur ve olay dinleyicilerini ekler.
         */
        function buildGridUI() {
            gridEl.innerHTML = "";
            listEl.innerHTML = wordsToPlace.map(w => `<div id="word_${w}" class="word-item"><span class="word-item-description">${wordDescriptions[w]}</span></div>`).join("");
            gridEl.style.gridTemplate = `repeat(${gridSize}, 1fr) / repeat(${gridSize}, 1fr)`;
            
            grid.forEach((row, rowIndex) => {
                row.forEach((letter, colIndex) => {
                    const cell = document.createElement("div");
                    cell.className = "cell";
                    cell.textContent = letter;
                    cell.dataset.row = rowIndex;
                    cell.dataset.col = colIndex;
                    
                    cell.addEventListener("mousedown", startSelection);
                    cell.addEventListener("mouseenter", continueSelection);
                    cell.addEventListener("touchstart", startSelection);
                    cell.addEventListener("touchmove", touchMoveHandler);
                    
                    gridEl.appendChild(cell);
                });
            });
        }
        
        /**
         * Seçim başlangıcını yönetir.
         * @param {Event} event - Fare veya dokunmatik olay
         */
        function startSelection(event) {
            event.preventDefault();
            isSelecting = true;
            clearSelection();
            const cell = event.target;
            currentSelection.push(cell);
            cell.classList.add("selected");
            updateSelectedWord();
        }

        /**
         * Seçime devam etmeyi yönetir.
         * @param {Event} event - Fare veya dokunmatik olay
         */
        function continueSelection(event) {
            if (!isSelecting) return;
            const cell = event.target;
            if (!cell || !cell.classList.contains("cell") || currentSelection.includes(cell)) return;

            const lastCell = currentSelection[currentSelection.length - 1];
            const firstCell = currentSelection[0];

            const dirRow = parseInt(cell.dataset.row) - parseInt(firstCell.dataset.row);
            const dirCol = parseInt(cell.dataset.col) - parseInt(firstCell.dataset.col);
            
            const lastDirRow = parseInt(lastCell.dataset.row) - parseInt(firstCell.dataset.row);
            const lastDirCol = parseInt(lastCell.dataset.col) - parseInt(firstCell.dataset.col);            
            // Sadece düz yatay veya dikey seçimlere izin ver
            if ((dirRow !== 0 && dirCol !== 0) || (Math.sign(lastDirCol) !== Math.sign(dirCol) && Math.sign(lastDirRow) !== Math.sign(dirRow))) {
                endSelection(); 
                return;
            }            
            // Yön değişimi kontrolü (köşegenleri engellemek için)
            if (currentSelection.length > 2) {
                const prevCell = currentSelection[currentSelection.length - 2];
                const prevDirRow = parseInt(lastCell.dataset.row) - parseInt(prevCell.dataset.row);
                const prevDirCol = parseInt(lastCell.dataset.col) - parseInt(prevCell.dataset.col);
                const currentDirRow = parseInt(cell.dataset.row) - parseInt(lastCell.dataset.row);
                const currentDirCol = parseInt(cell.dataset.col) - parseInt(lastCell.dataset.col);
                if (Math.sign(prevDirCol) !== Math.sign(currentDirCol) || Math.sign(prevDirRow) !== Math.sign(currentDirRow)) {
                    endSelection();
                    return;
                }
            }
            
            currentSelection.push(cell);
            cell.classList.add("selected");
            updateSelectedWord();
        }
        /**
         * Dokunmatik hareketi yönetir.
         * @param {Event} event - Dokunmatik olay
         */
        function touchMoveHandler(event) {
            event.preventDefault();
            const touch = event.touches[0];
            const cell = document.elementFromPoint(touch.clientX, touch.clientY);
            if (cell && cell.classList.contains("cell")) {
                continueSelection({target: cell});
            }
        }
                /**
         * Seçilen kelimeyi arayüzde gösterir.
         */
        function updateSelectedWord() {
            const word = currentSelection.map(cell => cell.textContent).join("");
            selEl.textContent = `Seçilen: ${word}`;
        }
                /**
         * Seçim alanını temizler.
         */
        function clearSelection() {
            gridEl.querySelectorAll(".cell.selected").forEach(cell => cell.classList.remove("selected"));
            currentSelection = [];
            selEl.textContent = "Seçilen: ";
        }
        /**
         * Seçim işlemini sonlandırır ve kelimeyi kontrol eder.
         */
        function endSelection() {
            if (!isSelecting) return;
            checkWord();
            isSelecting = false;
        }
        /**
         * Seçilen kelimeyi kontrol eder.
         */
        function checkWord() {
            isSelecting = false;
            if (currentSelection.length === 0) return;

            const selectedWord = currentSelection.map(cell => cell.textContent).join("");
            const reversedWord = currentSelection.map(cell => cell.textContent).reverse().join("");
            
            if (wordsToPlace.includes(selectedWord) && !foundWords.includes(selectedWord)) {
                handleCorrectWord(selectedWord);
            } else if (wordsToPlace.includes(reversedWord) && !foundWords.includes(reversedWord)) {
                handleCorrectWord(reversedWord);
            } else {
                handleWrongWord();
            }
        }

        /**
         * Doğru kelime bulunduğunda yapılacakları yönetir.
         * @param {string} word - Bulunan kelime
         */
        function handleCorrectWord(word) {
            correctSynth.triggerAttackRelease("C5", "8n");
            
            // Hücreleri "bulundu" olarak işaretle
            currentSelection.forEach(cell => {
                cell.classList.remove("selected");
                cell.classList.add("found");
                cell.classList.add("correct-highlight");
                // Hücrenin kalıcı olarak "found" statüsünü tut
                cellFoundStatus[`${cell.dataset.row}-${cell.dataset.col}`] = true;
            });

            foundWords.push(word);
            score++;
            scoreEl.textContent = score;
            remainingEl.textContent = wordsToPlace.length - foundWords.length;
            updateProgressBar();
            
            // Kelime listesinde kelimeyi işaretle
            const listItem = document.getElementById(`word_${word}`);
            if (listItem) {
                listItem.classList.add("found");
                const descriptionSpan = listItem.querySelector(".word-item-description");
                if (descriptionSpan) {
                    descriptionSpan.innerHTML = `<span class="found-word-text">${word}</span><br>${wordDescriptions[word]}`;
                }
            }

            clearSelection();

            // Oyun bitti mi kontrol et
            if (foundWords.length === wordsToPlace.length) {
                endGame(true);
            }
        }
        
        /**
         * Yanlış kelime bulunduğunda yapılacakları yönetir.
         */
        function handleWrongWord() {
            wrongSynth.triggerAttackRelease("D3", "8n");
            
            // Seçilen hücrelere yanlış vurgulama sınıfını ekle
            currentSelection.forEach(cell => {
                // Eğer hücre zaten doğru bulunmuş bir kelimenin parçası değilse animasyonu uygula
                if (!cell.classList.contains("found")) {
                    cell.classList.add("wrong-highlight");
                }
            });

            // Vurgulama animasyonu bittikten sonra sınıfları temizle
            setTimeout(() => {
                currentSelection.forEach(cell => {
                    cell.classList.remove("selected");
                    cell.classList.remove("wrong-highlight");
                });
                clearSelection();
            }, 500); // CSS animasyon süresi 0.5s (500ms) olduğu için bu süreyi kullan
        }
        
        /**
         * İpucu verir.
         */
        function giveHint() {
            if (hintTimer) {
                // İpucu zaten gösteriliyorsa yeni bir tane gösterme
                return;
            }

            hintSynth.triggerAttackRelease("G4", "8n");
            
            const unfoundWords = wordsToPlace.filter(w => !foundWords.includes(w));
            if (unfoundWords.length > 0) {
                const randomWord = unfoundWords[Math.floor(Math.random() * unfoundWords.length)];
                const firstCellPosition = wordPositions[randomWord];
                if (firstCellPosition) {
                    const cell = gridEl.querySelector(`[data-row="${firstCellPosition.startRow}"][data-col="${firstCellPosition.startCol}"]`);
                    if (cell && !cellFoundStatus[`${firstCellPosition.startRow}-${firstCellPosition.startCol}`]) {
                        // İlk harfe ipucu vurgusu ekle
                        cell.classList.add("hint-highlight");
                        hintTimer = setTimeout(() => {
                            cell.classList.remove("hint-highlight");
                            hintTimer = null;
                        }, 1500); // 1.5 saniye sonra vurguyu kaldır
                    }
                }
            }
        }
        
        /**
         * Oyun sonu ekranını yönetir.
         * @param {boolean} win - Oyun kazanıldı mı?
         */
        function endGame(win) {
            clearInterval(timerId);
            hideAllControls();
            
            if (win) {
                winSynth.triggerAttackRelease(["C5", "E5", "G5"], "4n");
                endGameTitle.textContent = "Tebrikler!";
                endGameMessage.textContent = "Tüm kelimeleri buldunuz!";
                modalShowAnswersBtn.style.display = "none";
            } else {
                warningSynth.triggerAttackRelease("C3", "2n");
                endGameTitle.textContent = "Süre Doldu!";
                endGameMessage.textContent = "Süre dolduğu için oyun sona erdi. Daha hızlı olmalısın!";
                modalShowAnswersBtn.style.display = "inline-block";
            }
            showModal(endGameModal);
        }

        /**
         * Cevapları gösterir.
         */
        function showAnswers() {
            wordsToPlace.forEach(word => {
                if (!foundWords.includes(word)) {
                    const pos = wordPositions[word];
                    if (pos) {
                        const path = [];
                        for (let i = 0; i < word.length; i++) {
                            path.push({r: pos.startRow + i * pos.dir.r, c: pos.startCol + i * pos.dir.c});
                        }
                        path.forEach(p => {
                            const cell = gridEl.querySelector(`[data-row="${p.r}"][data-col="${p.c}"]`);
                            if (cell) {
                                cell.classList.add("unfound-answer");
                                cell.classList.remove("found"); // Eğer doğru bir kelimeyle kesişiyorsa kaldır
                            }
                        });
                    }
                    // Kelime listesinde işaretle
                    const listItem = document.getElementById(`word_${word}`);
                    if (listItem) {
                        listItem.classList.add("unfound-answer");
                        const descriptionSpan = listItem.querySelector(".word-item-description");
                        if (descriptionSpan) {
                            descriptionSpan.innerHTML = `<span class="unfound-word-text">${word}</span><br>${wordDescriptions[word]}`;
                        }
                    }
                }
            });
            hideModal(endGameModal);
        }
        
        /**
         * İlerleme çubuğunu günceller.
         */
        function updateProgressBar() {
            const totalWords = wordsToPlace.length;
            const progress = (foundWords.length / totalWords) * 100;
            progressBar.style.width = `${progress}%`;
        }

        /**
         * Modalı gösterir.
         * @param {Element} modal - Gösterilecek modal elementi
         */
        function showModal(modal) {
            modal.style.display = "flex";
        }

        /**
         * Modalı gizler.
         * @param {Element} modal - Gizlenecek modal elementi
         */
        function hideModal(modal) {
            modal.style.display = "none";
        }
        
        /**
         * Tüm oyun kontrollerini gizler.
         */
        function hideAllControls() {
            document.getElementById("game-controls").style.display = "none";
            document.getElementById("game-status").style.display = "none";
            document.querySelector(".progress-bar-container").style.display = "none";
            listEl.style.display = "none";
        }
        
        // Olay dinleyicileri
        startBtn.addEventListener("click", startGame);
        resetBtn.addEventListener("click", startGame);
        hintBtn.addEventListener("click", giveHint);
        howToBtn.addEventListener("click", () => showModal(howToModal));
        howToModalCloseBtn.addEventListener("click", () => hideModal(howToModal));
        modalPlayAgainBtn.addEventListener("click", startGame);
        modalShowAnswersBtn.addEventListener("click", showAnswers);
        
        document.body.addEventListener("mouseup", endSelection);
        document.body.addEventListener("touchend", endSelection);

        // Oyun başladığında veya sayfa yüklendiğinde "Nasıl Yapılır?" modalını göster
        document.addEventListener("DOMContentLoaded", () => {
             howToBtn.click();
        });
    </script>
</body>
</html>
