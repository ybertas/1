<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hayvan Ağırlığı Sıralama Oyunu</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        /* Genel stil sıfırlamaları ve temel ayarlar */
        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            overflow-x: hidden;
            background-image: url("https://www.shutterstock.com/shutterstock/photos/2599085511/display_1500/stock-vector-bamboo-forest-tropical-jungle-branches-bamboo-grove-with-tropical-forest-background-and-exotic-2599085511.jpg");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .container {
            width: 100%;
            max-width: 1024px;
            background-color: #ffffff;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 30px;
            text-align: center;
            box-sizing: border-box;
            position: relative;
        }

        h1 {
            color: #333;
            margin-bottom: 25px;
            font-size: 2.2em;
        }

        .draggable-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 40px;
            min-height: 180px;
            align-items: center;
            border: 3px dashed #ccc;
            border-radius: 20px;
            padding: 20px;
            box-sizing: border-box;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .draggable {
            width: 150px;
            height: 150px;
            color: #fff;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 2.2em;
            font-weight: bold;
            border-radius: 20px;
            cursor: grab;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease, background-color 0.3s ease, border-color 0.3s ease, outline 0.2s ease-in-out;
            position: relative;
            user-select: none;
            touch-action: none;
            border: 2px solid transparent;
            padding-top: 15px;
            outline: 4px solid transparent; /* İpucu için eklendi */
        }

        .animal-item { /* Hayvan resimleri için özel stil */
            padding: 10px;
            background-color: #f0f0f0 !important; /* Resimler için arka planı beyaz yap */
            border: 2px solid #ccc;
            color: #333; /* Metin rengi */
        }

        .animal-item img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 10px;
        }

        .placeholder {
            width: 150px;
            height: 150px;
            background-color: rgba(0, 0, 0, 0.1);
            border: 2px dashed #999;
            border-radius: 20px;
            flex-shrink: 0;
        }

        .draggable:active {
            cursor: grabbing;
            transform: scale(1.05); /* Keep for initial click feedback */
        }

        .draggable.is-dragging {
            z-index: 1000;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            opacity: 0.9;
        }

        .draggable.correct-box {
            background-color: #28a745 !important;
            border-color: #28a745;
        }
        .draggable.incorrect-box {
            background-color: #dc3545 !important;
            border-color: #dc3545;
        }

        /* Hayvan resimleri için doğru/yanlış kutu stilleri */
        .animal-item.correct-box {
            border-color: #28a745;
            box-shadow: 0 0 15px #28a745;
            background-color: #e6ffe6 !important; /* Doğru hayvan kutusu için açık yeşil arka plan */
        }
        .animal-item.incorrect-box {
            border-color: #dc3545;
            box-shadow: 0 0 15px #dc3545;
            background-color: #ffe6e6 !important; /* Yanlış hayvan kutusu için açık kırmızı arka plan */
        }

        .order-number {
            position: absolute;
            top: 5px;
            left: 5px;
            background-color: rgba(0, 0, 0, 0.85); /* Daha da koyu ve opak arka plan */
            color: #ade8f4; /* Açık mavi/turkuaz */
            font-size: 0.9em; /* Biraz daha büyük */
            padding: 5px 10px; /* Biraz daha dolgu */
            border-radius: 10px; /* Hafifçe daha yuvarlak köşeler */
            font-weight: bold; /* Kalın yap */
            text-shadow: 0 0 3px rgba(0,0,0,0.5); /* Hafif gölge */
        }
        .expression-text { font-size: 1em; margin-bottom: 5px; }
        .result-text { font-size: 0.7em; color: rgba(255, 255, 255, 0.8); font-weight: normal; }
        
        .buttons-section {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 2rem;
        }
        .buttons-section button {
            padding: 0.9rem 1.6rem;
            font-size: 1.05rem;
            font-weight: 700;
            transition: transform 0.16s, background 0.19s;
            border-radius: 0.75rem;
            cursor: pointer;
        }
        
        button:disabled {
            filter: grayscale(80%);
            cursor: not-allowed;
            transform: none !important;
        }

        #check-button {
            background: linear-gradient(90deg, #8b5cf6, #a855f7 60%);
            color: #fff;
            box-shadow: 0 2px 10px #c4b5fd99;
            border: none;
        }
        #check-button:hover:not(:disabled) {
            background: linear-gradient(90deg, #a855f7, #8b5cf6 60%);
            transform: scale(1.08) rotate(-1deg);
        }
        
        #hint-button {
            background: linear-gradient(90deg, #a3e635, #16a34a 60%);
            color: #2d3748;
            box-shadow: 0 2px 10px #bbf7d066;
            border: none;
        }
        #hint-button:hover:not(:disabled) {
            background: linear-gradient(90deg, #16a34a, #a3e635 60%);
            color: #fff;
            transform: scale(1.08) rotate(1deg);
        }

        #reset-button {
            background: linear-gradient(90deg, #fbbf24, #f59e42 60%);
            color: #fff;
            box-shadow: 0 2px 10px #fde68a66;
            border: none;
        }
        #reset-button:hover:not(:disabled) {
            background: linear-gradient(90deg, #f59e42, #fbbf24 60%);
            transform: scale(1.08) rotate(-2deg);
        }

        #results-button {
            background: linear-gradient(90deg, #ef4444, #f87171 60%);
            color: #fff;
            box-shadow: 0 2px 10px #fecaca88;
            border: none;
        }
        #results-button:hover:not(:disabled) {
            background: linear-gradient(90deg, #f87171, #ef4444 60%);
            transform: scale(1.08) rotate(2deg);
        }

        #how-to-play-button {
            background: linear-gradient(90deg, #60a5fa, #3b82f6 60%);
            color: #fff;
            box-shadow: 0 2px 10px #bfdbfe99;
            border: none;
        }
        #how-to-play-button:hover:not(:disabled) {
            background: linear-gradient(90deg, #3b82f6, #60a5fa 60%);
            transform: scale(1.08) rotate(0deg);
        }

        .score-timer-container { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding: 10px 20px; background-color: #e9ecef; border-radius: 10px; box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05); }
        .score-timer-item { font-size: 1.3em; font-weight: bold; color: #555; display: flex; align-items: center; gap: 8px; }
        .score-timer-item i { color: #007bff; }
        
        .timer-warning { color: #dc3545 !important; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: 1; } }

        /* Updated .message-box styles */
        .message-box {
            position: fixed;
            top: 12%;
            left: 50%;
            transform: translate(-50%, 0);
            width: 94vw;
            max-width: 540px;
            min-width: 280px;
            background: rgba(255, 255, 255, 0.88);
            color: #23272f;
            padding: 34px 30px 26px 30px;
            border-radius: 22px;
            box-shadow: 0 8px 40px 8px rgba(52, 58, 85, 0.12), 0 1.5px 8px 1px rgba(0,0,0,0.08);
            z-index: 2000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
            font-size: 1.14em;
            font-weight: 500;
            border: 1.5px solid #e6e9ef;
            backdrop-filter: blur(5.5px); /* cam efekti */
            animation: modalIn 0.45s cubic-bezier(.45,.15,.36,1.12);
        }

        /* New keyframes for modal animation */
        @keyframes modalIn {
            from { opacity: 0; transform: translate(-50%, -40px) scale(0.97);}
            to  { opacity: 1; transform: translate(-50%, 0) scale(1);}
        }

        /* New styles for text inside message-box */
        .message-box p, .message-box #messageText {
            font-size: 1.19em;
            color: #23272f;
            margin-bottom: 0.8em;
            font-weight: 500;
            text-shadow: none;
            line-height: 1.36;
        }

        /* Updated .message-box button styles */
        .message-box button {
            margin-top: 18px;
            background: linear-gradient(90deg, #5eead4, #3b82f6 70%);
            color: #1e293b;
            padding: 12px 32px;
            border-radius: 22px;
            font-size: 1.05em;
            font-weight: 600;
            border: none;
            box-shadow: 0 2px 12px 0 rgba(60, 140, 255, 0.12);
            letter-spacing: 0.04em;
            cursor: pointer;
            transition: background 0.18s, color 0.18s, transform 0.12s;
        }
        .message-box button:hover {
            background: linear-gradient(90deg, #3b82f6, #5eead4 70%);
            color: #fff;
            transform: scale(1.06);
        }

        /* Specific styles for howToPlayModal - these will override .message-box for centering */
        #howToPlayModal { 
            text-align: left; 
            background-color: rgba(190, 200, 220, 0.95); 
            color: #333; 
            top: 50%; /* Centered vertically */
            left: 50%; /* Centered horizontally */
            transform: translate(-50%, -50%); /* Ensures true centering */
            max-height: 80vh; /* Ensure it fits on screen, add scroll if content overflows */
            overflow-y: auto; /* Enable vertical scrolling */
            /* Resetting some styles that might be inherited from .message-box if desired */
            padding: 30px; /* Original padding for howToPlayModal */
            border-radius: 15px; /* Original border-radius for howToPlayModal */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); /* Original box-shadow for howToPlayModal */
            animation: none; /* Do not apply modalIn animation to howToPlayModal if you want it to appear instantly or with its own specific animation */
        }
        #howToPlayModal h2 { text-align: center; color: #333; margin-bottom: 15px; }
        #howToPlayModal ol { list-style-position: inside; padding-left: 0; margin-left: 20px; }
        #howToPlayModal li { margin-bottom: 5px; line-height: 1.3; font-size: 0.95em; }
        /* Buttons inside howToPlayModal will inherit .message-box button styles, which is fine */

        @media (max-width: 768px) {
            h1 { font-size: 1.8em; }
            .draggable, .placeholder { width: 120px; height: 120px; }
            .draggable { font-size: 1.8em; }
            .order-number { font-size: 0.7em; padding: 3px 8px; }
            .draggable-container { gap: 15px; min-height: 150px; }
            .score-timer-item { font-size: 1.1em; }
            .buttons-section button {
                padding: 0.7rem 1.3rem;
                font-size: 0.95rem;
            }
            .message-box { /* Adjust for smaller screens */
                width: 95%;
                max-width: none; /* Remove max-width on smaller screens */
                top: 10%; /* Keep top: 10% for mobile as well */
                transform: translate(-50%, 0); /* Keep transform for mobile as well */
            }
            #howToPlayModal {
                top: 50%; /* Keep centered on mobile too */
            }
        }

        @media (max-width: 480px) {
            .container { padding: 20px; }
            h1 { font-size: 1.5em; }
            .draggable, .placeholder { width: 90%; max-width: 150px; height: 100px; }
            .draggable { font-size: 1.5em; }
            .order-number { font-size: 0.6em; padding: 2px 6px; }
            .draggable-container { flex-direction: column; gap: 10px; min-height: 450px; padding: 10px; }
            .score-timer-item { font-size: 1em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="game-title">Hayvanları Ağırlığına Göre Büyükten Küçüğe Sırala</h1>

        <div class="score-timer-container">
            <div class="score-timer-item">
                <i class="fas fa-redo"></i> Deneme: <span id="attempts">0</span>
            </div>
            <div class="score-timer-item">
                <i class="fas fa-clock"></i> Kalan Süre: <span id="timer">60</span>
            </div>
        </div>

        <div class="draggable-container">
            <!-- Hayvan kutuları JavaScript ile dinamik olarak eklenecek -->
        </div>

        <div class="buttons-section">
            <button id="check-button">Kontrol Et</button>
            <button id="hint-button">İpucu</button>
            <button id="results-button">Cevapları Göster</button>
            <button id="reset-button">Yeniden Dene</button>
            <button id="how-to-play-button">Nasıl Oynanır?</button>
        </div>
    </div>

    <div class="message-box" id="howToPlayModal">
        <h2 id="how-to-play-title">Nasıl Oynanır?</h2>
        <ol id="how-to-play-list">
            <li>Hayvanları ağırlığına göre büyükten küçüğe doğru sıralayın.</li>
            <li>Kutuları sürükleyip bırakarak yerlerini değiştirebilirsiniz.</li>
            <li>Her deneme için <span style="font-weight: bold;">60 saniyeniz</span> var.</li>
            <li>"Kontrol Et" butonu ile sıralamanızı kontrol edin.</li>
            <li>Doğru yerdeki kutular yeşil, yanlış yerdekiler kırmızı olacaktır.</li>
            <li>"İpucu" butonuna her turda yalnızca bir kez basabilirsiniz.</li>
            <li>"Cevapları Göster" butonu doğru sıralamayı ve ağırlıklarını gösterecektir.</li>
        </ol>
        <button id="howToPlayCloseButton">Oyunu Başlat</button>
    </div>

    <div class="message-box" id="messageBox">
        <p id="messageText"></p>
        <button id="messageBoxCloseButton">Tamam</button>
    </div>

    <script>
        const draggableContainer = document.querySelector('.draggable-container');
        const checkButton = document.getElementById('check-button');
        const resetButton = document.getElementById('reset-button');
        const resultsButton = document.getElementById('results-button');
        const hintButton = document.getElementById('hint-button');
        const howToPlayButton = document.getElementById('how-to-play-button');
        const attemptsDisplay = document.getElementById('attempts');
        const timerDisplay = document.getElementById('timer');
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        const messageBoxCloseButton = document.getElementById('messageBoxCloseButton');
        const howToPlayModal = document.getElementById('howToPlayModal');
        const howToPlayCloseButton = document.getElementById('howToPlayCloseButton');
        const gameTitleElement = document.getElementById('game-title');
        const howToPlayTitle = document.getElementById('how-to-play-title');
        const howToPlayList = document.getElementById('how-to-play-list');


        let correctSynth, incorrectSynth;
        let draggedItem = null; // Orijinal sürüklenen öğe
        let draggedClone = null; // Sürükleme için kullanılan klon
        let placeholder = null;
        let attempts = 0;
        let timeLeft = 60;
        let timerInterval;
        let gameStarted = false;
        let gameEnded = false;
        let currentGameMode = 'animals'; // Sadece 'animals' modu kaldı

        // Fare/dokunma pozisyonu için offset
        let offsetX, offsetY;

        // Data for Animal Sorting Game (heaviest to lightest)
        const initialAnimalsData = [
            { name: "Ayı", value: 500, imageUrl: "https://www.shutterstock.com/shutterstock/photos/2636663713/display_1500/stock-vector-a-cartoon-bear-is-sitting-on-a-white-background-the-bear-is-smiling-and-he-is-happy-2636663713.jpg" },
            { name: "Köpek", value: 30, imageUrl: "https://www.shutterstock.com/shutterstock/photos/2596407961/display_1500/stock-photo-portrait-of-a-cute-happy-dog-looking-at-camera-australian-sheperd-dog-breed-isolated-on-white-2596407961.jpg" },
            { name: "Kedi", value: 4, imageUrl: "https://www.shutterstock.com/shutterstock/photos/2625476317/display_1500/stock-photo-cute-black-and-white-cat-isolated-on-white-2625476317.jpg" },
            { name: "Fil", value: 6000, imageUrl: "https://www.shutterstock.com/shutterstock/photos/2621223631/display_1500/stock-photo-african-elephant-isolated-on-white-background-2621223631.jpg" }
        ];
        // Correct order for animals (heaviest to lightest based on 'value')
        const correctAnimalOrder = [6000, 500, 30, 4]; // Fil, Ayı, Köpek, Kedi

        let currentCorrectOrder = [];
        let currentInitialData = [];

        function createAndShuffleDraggables() {
            draggableContainer.innerHTML = '';
            let shuffledData;

            // Sadece hayvan modu kaldı
            shuffledData = [...initialAnimalsData].sort(() => Math.random() - 0.5);
            currentCorrectOrder = correctAnimalOrder;
            currentInitialData = initialAnimalsData;
            gameTitleElement.textContent = "Hayvanları Ağırlığına Göre Büyükten Küçüğe Sırala";
            howToPlayTitle.textContent = "Nasıl Oynanır?"; // Başlık basitleştirildi
            howToPlayList.innerHTML = `
                <li>Hayvanları ağırlığına göre büyükten küçüğe doğru sıralayın.</li>
                <li>Kutuları sürükleyip bırakarak yerlerini değiştirebilirsiniz.</li>
                <li>Her deneme için <span style="font-weight: bold;">60 saniyeniz</span> var.</li>
                <li>"Kontrol Et" butonu ile sıralamanızı kontrol edin.</li>
                <li>Doğru yerdeki kutular yeşil, yanlış yerdekiler kırmızı olacaktır.</li>
                <li>"İpucu" butonuna her turda yalnızca bir kez basabilirsiniz.</li>
                <li>"Cevapları Göster" butonu doğru sıralamayı ve ağırlıklarını gösterecektir.</li>
            `;
            
            shuffledData.forEach((itemData) => {
                const draggable = document.createElement('div');
                draggable.classList.add('draggable');
                draggable.classList.add('animal-item'); // Hayvan öğesi sınıfı
                draggable.dataset.value = itemData.value;

                draggable.innerHTML = `
                    <span class="order-number"></span>
                    <img src="${itemData.imageUrl}" alt="${itemData.name}" onerror="this.onerror=null;this.src='https://placehold.co/150x150/CCCCCC/000000?text=Resim+Yok';" style="width: 100%; height: 100%; object-fit: contain;">
                    <span class="result-text" style="display: none;">Ağırlık: ${itemData.value}kg</span>
                `;
                
                draggableContainer.appendChild(draggable);
            });
            addDraggableEventListeners();
            updateCurrentOrderNumbers();
        }

        function addDraggableEventListeners() {
            const draggables = document.querySelectorAll('.draggable');
            draggables.forEach(draggable => {
                draggable.addEventListener('mousedown', dragStart);
                draggable.addEventListener('touchstart', dragStart, { passive: false });
            });
        }

        function dragStart(e) {
            if (gameEnded) return;
            e.preventDefault();
            draggedItem = e.target.closest('.draggable');
            if (!draggedItem) return;

            // Orijinal öğenin boyutlarını ve konumunu al
            const rect = draggedItem.getBoundingClientRect();
            offsetX = (e.type === 'touchstart' ? e.touches[0].clientX : e.clientX) - rect.left;
            offsetY = (e.type === 'touchstart' ? e.touches[0].clientY : e.clientY) - rect.top;
            
            placeholder = document.createElement('div');
            placeholder.classList.add('placeholder');
            placeholder.style.width = rect.width + 'px';
            placeholder.style.height = rect.height + 'px';

            // Orijinal öğeyi yer tutucuyla değiştiriyoruz.
            // Bu, öğe sayısını sabit tutar ve kaymayı önler.
            draggedItem.parentNode.replaceChild(placeholder, draggedItem);

            // Sürüklemek için klon oluştur
            draggedClone = draggedItem.cloneNode(true);
            draggedClone.style.visibility = 'visible'; // Klon her zaman görünür olmalı
            draggedClone.style.position = 'fixed';
            draggedClone.style.left = `${rect.left}px`;
            draggedClone.style.top = `${rect.top}px`;
            draggedClone.style.zIndex = '1000';
            draggedClone.style.opacity = '0.7';
            draggedClone.style.pointerEvents = 'none';
            draggedClone.classList.add('is-dragging');
            document.body.appendChild(draggedClone);
            
            document.addEventListener('mousemove', dragMove);
            document.addEventListener('mouseup', dragEnd);
            document.addEventListener('touchmove', dragMove, { passive: false });
            document.addEventListener('touchend', dragEnd);
        }

        function dragMove(e) {
            if (!draggedClone) return; // draggedClone kontrolü yapıldı
            e.preventDefault();

            const clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
            const clientY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY;
            
            // Klonun konumunu güncelle
            draggedClone.style.left = `${clientX - offsetX}px`;
            draggedClone.style.top = `${clientY - offsetY}px`;

            const afterElement = getDragAfterElement(draggableContainer, clientX, clientY);
            if (afterElement == null) {
                // Eğer hiçbir öğe yoksa veya en sona sürükleniyorsa
                if (placeholder.parentNode !== draggableContainer || draggableContainer.lastChild !== placeholder) {
                    draggableContainer.appendChild(placeholder);
                }
            } else {
                // Yer tutucuyu doğru konuma taşı
                if (placeholder.parentNode !== afterElement.parentNode || afterElement.previousSibling !== placeholder) {
                     draggableContainer.insertBefore(placeholder, afterElement);
                }
            }
        }

        function dragEnd() {
            if (!draggedClone) return; // draggedClone kontrolü yapıldı

            // Klonu body'den kaldır
            if (draggedClone.parentNode) {
                draggedClone.parentNode.removeChild(draggedClone);
            }
            
            if (placeholder && placeholder.parentNode) {
                // Yer tutucuyu orijinal öğe ile geri değiştiriyoruz.
                placeholder.parentNode.replaceChild(draggedItem, placeholder);
            }
            
            placeholder = null; // Yer tutucu referansını temizle
            draggedItem = null; // Orijinal öğe referansını temizle
            draggedClone = null; // Klon referansını temizle
            
            updateCurrentOrderNumbers();
            
            document.removeEventListener('mousemove', dragMove);
            document.removeEventListener('mouseup', dragEnd);
            document.removeEventListener('touchmove', dragMove);
            document.removeEventListener('touchend', dragEnd);
        }

        function getDragAfterElement(container, x, y) {
            const draggableElements = [...container.querySelectorAll('.draggable:not(.is-dragging)')];
            const flexDirection = getComputedStyle(container).flexDirection;

            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                let offset = (flexDirection === 'column') 
                    ? (y - box.top - box.height / 2) 
                    : (x - box.left - box.width / 2);

                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function updateCurrentOrderNumbers() {
            const draggables = document.querySelectorAll('.draggable');
            draggables.forEach((draggable, index) => {
                draggable.querySelector('.order-number').textContent = index + 1;
            });
        }

        function resetGame() { 
            clearInterval(timerInterval);
            gameEnded = false;
            currentGameMode = 'animals'; 

            // Mesaj kutusunu kapat
            messageBox.style.display = 'none'; 

            if (!gameStarted) {
                attempts = 1;
                gameStarted = true;
            } else {
                attempts++;
            }
            attemptsDisplay.textContent = attempts;

            timeLeft = 60;
            timerDisplay.textContent = timeLeft;
            timerDisplay.parentElement.classList.remove('timer-warning');

            createAndShuffleDraggables(); 
            checkButton.disabled = false;
            resultsButton.disabled = false;
            hintButton.disabled = false;
            startTimer();
        }

        function startTimer() {
            if (gameEnded) return;
            timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = timeLeft;
                if (timeLeft <= 10 && !timerDisplay.parentElement.classList.contains('timer-warning')) {
                    timerDisplay.parentElement.classList.add('timer-warning');
                }
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    gameEnded = true;
                    showMessage(`Süre doldu! Yeniden Dene butonuna basarak oyunu tekrar başlatabilirsiniz.`);
                    checkButton.disabled = true;
                    resultsButton.disabled = true;
                    hintButton.disabled = true;
                }
            }, 1000);
        }

        function showMessage(msg) { 
            messageText.innerHTML = msg;
            messageBox.style.display = 'flex';
            messageBoxCloseButton.style.display = 'block'; 
        }

        messageBoxCloseButton.addEventListener('click', () => {
            messageBox.style.display = 'none';
        });

        checkButton.addEventListener('click', () => {
            clearInterval(timerInterval);
            gameEnded = true;
            checkButton.disabled = true;
            resultsButton.disabled = true;
            hintButton.disabled = true;

            const currentDraggables = Array.from(draggableContainer.children);
            let allCorrect = true;

            currentDraggables.forEach((draggable, index) => {
                const value = parseFloat(draggable.dataset.value); 
                draggable.classList.remove('correct-box', 'incorrect-box');
                
                if (value === currentCorrectOrder[index]) {
                    draggable.classList.add('correct-box');
                } else {
                    draggable.classList.add('incorrect-box');
                    allCorrect = false;
                }
                draggable.querySelector('.result-text').style.display = 'block';
            });

            if (allCorrect) {
                let successMessage = `Tebrikler! Doğru sıralama yaptın. Bitirdiğin süre: ${60 - timeLeft} saniye.`;
                showMessage(successMessage); 
                correctSynth.triggerAttackRelease("G5", "8n"); 
            } else {
                showMessage(`Tekrar dene! Sıralama yanlış. Bitirdiğin süre: ${60 - timeLeft} saniye.`); 
                incorrectSynth.triggerAttackRelease("C3", "8n");
            }
        });

        resetButton.addEventListener('click', () => resetGame()); 

        resultsButton.addEventListener('click', () => {
            if (gameEnded) return;
            clearInterval(timerInterval);
            gameEnded = true;
            checkButton.disabled = true;
            resultsButton.disabled = true;
            hintButton.disabled = true;

            const draggables = Array.from(draggableContainer.querySelectorAll('.draggable'));
            const firstPositions = new Map();
            draggables.forEach(draggable => {
                firstPositions.set(draggable, draggable.getBoundingClientRect());
            });

            // Hayvan modu için sıralama
            const sortedDraggables = draggables.sort((a, b) => {
                return currentCorrectOrder.indexOf(parseFloat(a.dataset.value)) - currentCorrectOrder.indexOf(parseFloat(b.dataset.value));
            });

            sortedDraggables.forEach(draggable => {
                draggableContainer.appendChild(draggable);
                draggable.querySelector('.result-text').style.display = 'block';
                draggable.classList.add('correct-box');
            });
            updateCurrentOrderNumbers();

            sortedDraggables.forEach(draggable => {
                const lastPos = draggable.getBoundingClientRect();
                const firstPos = firstPositions.get(draggable);
                const dx = firstPos.left - lastPos.left;
                const dy = firstPos.top - lastPos.top;

                draggable.style.transform = `translate3d(${dx}px, ${dy}px, 0)`;
                draggable.style.transition = 'transform 0s';
            });

            requestAnimationFrame(() => {
                sortedDraggables.forEach(draggable => {
                    draggable.style.transition = 'transform 0.6s ease';
                    draggable.style.transform = 'translate3d(0, 0, 0)';
                });
            });

            showMessage(`Doğru sıralama bu şekilde olmalıydı. Bitirdiğin süre: ${60 - timeLeft} saniye.`);
        });

        hintButton.addEventListener('click', () => {
            if (gameEnded) return;

            const currentDraggables = [...draggableContainer.children];
            let hintGiven = false;
            for (let i = 0; i < currentDraggables.length; i++) {
                const draggable = currentDraggables[i];
                const value = parseFloat(draggable.dataset.value); 
                if (value !== currentCorrectOrder[i]) {
                    let hintText = `İpucu: ${i + 1}. sırada "${initialAnimalsData.find(d => d.value === currentCorrectOrder[i]).name}" (Ağırlık: ${initialAnimalsData.find(d => d.value === currentCorrectOrder[i]).value}kg) olmalı.`;
                    
                    showMessage(hintText);
                    
                    let flashCount = 0;
                    const flashInterval = setInterval(() => {
                        draggable.style.outline = (flashCount % 2 === 0) ? '4px solid #3b82f6' : 'transparent';
                        flashCount++;
                        if (flashCount > 5) {
                            clearInterval(flashInterval);
                            draggable.style.outline = 'transparent';
                        }
                    }, 200);

                    hintGiven = true;
                    break;
                }
            }

            if (!hintGiven) {
                showMessage("Harika gidiyorsun! Mevcut sıralamada bir hata yok.");
            }
            hintButton.disabled = true;
        });

        howToPlayButton.addEventListener('click', () => {
            howToPlayModal.style.display = 'flex';
        });


        window.onload = () => {
            correctSynth = new Tone.Synth().toDestination();
            incorrectSynth = new Tone.Synth().toDestination();
            howToPlayModal.style.display = 'flex';
        };

        howToPlayCloseButton.addEventListener('click', () => {
            if (Tone.context.state !== 'running') {
                Tone.start();
            }
            howToPlayModal.style.display = 'none';
            resetGame(); // Hayvan oyunu başlatılacak
        });
    </script>
</body>
</html>
