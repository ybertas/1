<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maden Eşleştirme Oyunu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
            box-sizing: border-box;
            background-image: url('https://lh3.googleusercontent.com/proxy/guN-expUXCpkk0Ohu_dyPegu_35rMnno2ek4L5GQpIitmbjJsKfbEeRq7H9q3dhusMTxvR2NQd1tc1t8KdCWAzNILSSB3gcKnoeVcUupLuILy89zZA');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        .game-container {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            padding: 1.5rem;
            max-width: 100%;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            box-sizing: border-box;
        }
        .game-columns {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .game-column {
            flex: 1;
            background-color: #f3f4f6;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.06);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }
        .draggable-item, .drop-zone-target {
            border-radius: 0.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 1rem;
            box-sizing: border-box;
        }
        .draggable-item {
            background-color: #4f46e5;
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 0 0 3px #818cf8;
            cursor: grab;
            width: 120px;
            height: 40px;
            flex-shrink: 0;
            transition: background-color 0.3s, transform 0.3s, box-shadow 0.3s;
        }
        .draggable-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15), 0 0 0 4px #6366f1;
        }
        .city-slot {
            width: 120px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px dashed #e5e7eb;
            border-radius: 0.5rem;
            box-sizing: border-box;
            background-color: #f8fafc;
            flex-shrink: 0;
            transition: border 0.3s, background-color 0.3s, box-shadow 0.3s;
        }
        .city-slot.empty-hidden {
            border: none;
            background-color: transparent;
            box-shadow: none;
        }
        .drop-zone {
            background-color: #e0e7ff;
            color: #312e81;
            border: 2px dashed #a5b4fc;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05), 0 0 0 2px #d1d5db;
            width: 100%;
            height: 60px;
        }
        .mineral-name-text {
            flex-grow: 1;
            flex-shrink: 0;
            font-size: 1rem;
            color: #312e81;
            font-weight: 700;
            text-align: center;
            max-width: 150px;
            padding: 0 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
        }
        .drop-zone-target {
            flex-grow: 0;
            width: 120px;
            height: 40px;
            border: 1px solid #a5b4fc;
            background-color: #f8fafc;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 0 0 2px #cbd5e1;
            box-sizing: border-box;
        }
        .drop-zone-target.hovered, .city-slot.hovered {
            background-color: #c7d2fe;
            border-color: #6366f1;
            box-shadow: inset 0 0 0 3px #6366f1;
        }
        .drop-zone-target .draggable-item {
            margin: 0;
            width: 100%;
            height: 100%;
            box-shadow: none;
            transform: none;
            transition: none;
        }
        .draggable-item.correct-match {
            background-color: #10b981;
            border-color: #059669;
            box-shadow: 0 0 0 4px #059669;
            transform: scale(1.05);
        }
        .draggable-item.incorrect-match {
            background-color: #ef4444;
            border-color: #dc2626;
            box-shadow: 0 0 0 4px #dc2626;
            transform: scale(1.05);
        }
        .drop-zone.correct .drop-zone-target {
            background-color: #86efac;
            border-color: #22c55e;
            box-shadow: inset 0 0 0 4px #22c55e, 0 0 15px rgba(34, 197, 94, 0.6);
            transform: scale(1.03);
        }
        .drop-zone.correct .mineral-name-text {
            color: #16a34a;
        }
        .drop-zone.incorrect .drop-zone-target {
            background-color: #fca5a5;
            border-color: #ef4444;
            box-shadow: inset 0 0 0 4px #ef4444, 0 0 15px rgba(239, 68, 68, 0.6);
            transform: scale(1.03);
        }
        .drop-zone.incorrect .mineral-name-text {
            color: #dc2626;
        }
        .button-primary {
            background-color: #10b981;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s, box-shadow 0.2s;
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .button-primary:hover {
            background-color: #059669;
            transform: translateY(-1px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
        }
        .button-secondary {
            background-color: #6b7280;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s, box-shadow 0.2s;
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .button-secondary:hover {
            background-color: #4b5563;
            transform: translateY(-1px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
        }
        /* Modal Arkaplanı: daha az opak */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.40); /* Az opaklık */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        /* Oyun Bitti Modalı: Ortadan yukarıda */
        .modal-overlay.game-over {
            align-items: flex-start !important;
        }
        .modal-overlay.game-over .modal-content {
            margin-top: 1.5rem;
        }
        /* Modal İçeriği (küçük kutu) */
        .modal-content {
            background-color: white;
            padding: 1.1rem 1.3rem;
            border-radius: 1rem;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.22);
            max-width: 350px;
            width: 94vw;
            font-size: 1.05rem;
            transform: translateY(0);
            transition: transform 0.3s;
            position: relative;
        }
        /* Nasıl Oynanır modalı geniş */
        #how-to-play-modal .modal-content {
            max-width: 900px;
            width: 800px;
            font-size: 1.05rem;
        }
        /* Mobilde modal genişliği tam ekran */
        @media (max-width: 850px) {
            .modal-content,
            #how-to-play-modal .modal-content {
                width: 99vw !important;
                max-width: 99vw !important;
                font-size: 0.97rem !important;
                padding: 1rem !important;
            }
        }
        /* İpucu modalı */
        #hint-modal .modal-content {
            width: 98vw !important;
            max-width: 1100px !important;
            padding: 1rem !important;
        }
        #hint-image {
            width: 100%;
            max-width: 1000px;
            height: auto;
            max-height: 90vh;
            object-fit: contain;
            border-radius: 0.5rem;
            box-shadow: 0 0 24px #ccc;
        }
        .modal-close-button {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            color: #4b5563;
            transition: color 0.2s;
            z-index: 1001;
        }
        .modal-close-button:hover {
            color: #1f2937;
        }
        @media (max-width: 768px) {
            .game-columns {
                flex-direction: column;
            }
            .game-column {
                width: 100%;
            }
            .game-container {
                padding: 1rem;
            }
            .draggable-item {
                width: 100px;
                height: 35px;
                font-size: 0.85rem;
            }
            .drop-zone-target {
                width: 100px;
                height: 35px;
            }
            .mineral-name-text {
                font-size: 0.9rem;
                max-width: 100px;
            }
            .city-slot {
                width: 100px;
                height: 55px;
            }
            .drop-zone {
                width: 100%;
                height: 55px;
            }
        }
    </style>
</head>
<body class="selection:bg-blue-200">
    <div class="game-container">
        <h1 class="text-3xl font-extrabold text-center text-gray-800 mb-4">Maden Eşleştirme Oyunu ⛏️</h1>
        <div class="flex justify-between items-center text-gray-700 font-semibold text-lg flex-wrap gap-2">
            <div id="timer" class="flex items-center gap-2">
                <span role="img" aria-label="Saat">⏰</span> Süre: 02:00
            </div>
            <div id="score" class="flex items-center gap-2">
                <span role="img" aria-label="Deneme">📝</span> Deneme: 0
            </div>
            <div id="incorrect-matches" class="flex items-center gap-2">
                <span role="img" aria-label="Yanlış Eşleşme">❌</span> Yanlış: 0
            </div>
        </div>
        <div class="game-columns flex flex-col md:flex-row gap-6">
            <div id="cities-column" class="game-column">
                <h2 class="text-xl font-bold text-gray-800 mb-4 text-center">Şehirler</h2>
            </div>
            <div id="minerals-column" class="game-column">
                <h2 class="text-xl font-bold text-gray-800 mb-4 text-center">Madenler</h2>
            </div>
        </div>
        <div class="flex justify-center gap-4">
            <button id="check-button" class="button-primary" disabled>Kontrol Et</button>
            <button id="hint-button" class="button-secondary">İpucu</button>
            <button id="play-again-button" class="button-secondary hidden">Yeniden Oyna</button>
        </div>
    </div>
    <!-- Nasıl Oynanır Modalı -->
    <div id="how-to-play-modal" class="modal-overlay show">
        <div class="modal-content">
            <h3 class="text-2xl font-bold text-gray-800 mb-4">Nasıl Oynanır?</h3>
            <p class="mb-3 text-left">
                <strong>Oyun Amacı:</strong><br>
                Şehir isimlerini doğru madenlerle eşleştirerek en yüksek skoru elde etmek ve tüm eşleşmeleri doğru yapmak.
            </p>
            <p class="mb-3 text-left">
                <strong>Kurallar & Oynanış:</strong>
                <ul class="list-disc ml-6 mt-1 text-base text-gray-700" style="text-align:left;">
                    <li>Sol sütunda <b>şehirler</b>, sağ sütunda ise <b>madenler</b> yer almaktadır.</li>
                    <li>Her şehir, sadece bir madene sürüklenip bırakılabilir.</li>
                    <li>Doğru eşleştirme için, şehir kutusunu ilgili madenin yanındaki boş alana sürükleyin.</li>
                    <li>Tüm şehirleri eşleştirince "Kontrol Et" butonuna tıklayın.</li>
                    <li>Doğru eşleşmeler <b>yeşil</b>, yanlış eşleşmeler <b>kırmızı</b> renkte görünür.</li>
                    <li>Yanlış eşleşmeler skordan düşülür. Tüm eşleşmeleri doğru yaparsanız oyunu kazanırsınız.</li>
                    <li>Oyunu tamamlamak için <b>2 dakika süreniz</b> var.</li>
                    <li>İsterseniz "İpucu" butonuna tıklayarak Türkiye Maden Haritası’nı inceleyebilirsiniz.</li>
                </ul>
            </p>
            <p class="mb-3 text-left">
                <strong>Puanlama:</strong><br>
                Her doğru eşleşme +10 puan kazandırır. Yanlış eşleşmelerde ise puan kaybedersiniz.
            </p>
            <p class="mb-3 text-left">
                <strong>Kontroller:</strong><br>
                Şehir kutularını <b>fare ile sürükleyip bırakın</b>. Mobilde parmağınızla da oynayabilirsiniz.
            </p>
            <p class="italic text-gray-600 mt-2">Bol şans! Tüm şehirleri doğru madeniyle eşleştirip yüksek puan almaya çalış!</p>
            <button id="start-game-button" class="button-primary mt-6">Başla</button>
        </div>
    </div>
    <!-- Oyun Bitti Modalı (Yukarıda, ortadan daha yukarıda çıkacak) -->
    <div id="game-over-modal" class="modal-overlay game-over">
        <div class="modal-content">
            <h3 id="modal-title" class="text-2xl font-bold text-gray-800 mb-4">Oyun Bitti!</h3>
            <p id="modal-message" class="text-lg text-gray-700 mb-6"></p>
            <button id="modal-play-again-button" class="button-primary">Yeniden Oyna</button>
        </div>
    </div>
    <!-- İpucu Modalı (Büyük resim) -->
    <div id="hint-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-button" id="close-hint-modal">&times;</button>
            <img id="hint-image" src="https://www.mapharita.com/images/turkiye-maden-haritasi.jpg" alt="İpucu Resmi: Türkiye Maden Haritası">
        </div>
    </div>
    <script>
        // Oyun verileri ve kodları (Kısaltılmış: Tam kodun aynısıdır)
        const gameData = [
            { city: 'Bursa', mineral: 'Bor' },
            { city: 'Sivas Divriği', mineral: 'Demir' },
            { city: 'Eskişehir', mineral: 'Lüle Taşı' },
            { city: 'Zonguldak', mineral: 'Kömür' },
            { city: 'Elazığ', mineral: 'Krom' },
            { city: 'Balıkesir', mineral: 'Mermer' }
        ];
        const mineralIcons = {
            'Bor': '🧪', 'Demir': '⚙️', 'Lüle Taşı': '☁️', 'Kömür': '⚫', 'Krom': '✨', 'Mermer': '🏛️'
        };
        const citiesColumn = document.getElementById('cities-column');
        const mineralsColumn = document.getElementById('minerals-column');
        const checkButton = document.getElementById('check-button');
        const playAgainButton = document.getElementById('play-again-button');
        const hintButton = document.getElementById('hint-button');
        const timerDisplay = document.getElementById('timer');
        const scoreDisplay = document.getElementById('score');
        const incorrectMatchesDisplay = document.getElementById('incorrect-matches');
        const howToPlayModal = document.getElementById('how-to-play-modal');
        const startGameButton = document.getElementById('start-game-button');
        const gameOverModal = document.getElementById('game-over-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const modalPlayAgainButton = document.getElementById('modal-play-again-button');
        const hintModal = document.getElementById('hint-modal');
        const closeHintModalButton = document.getElementById('close-hint-modal');
        let currentMatches = {}, score = 0, incorrectCount = 0, timeLeft = 120, timerInterval, gameActive = false;
        let trialCount = 0;
        const correctSynth = new Tone.Synth().toDestination();
        const incorrectSynth = new Tone.MembraneSynth().toDestination();
        const originalCitySlots = new Map();
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        function initializeGameElements() {
            currentMatches = {}; score = 0; incorrectCount = 0; timeLeft = 120; gameActive = false; trialCount = 0;
            updateScoreDisplay(); updateIncorrectMatchesDisplay(); updateTimerDisplay();
            citiesColumn.innerHTML = '<h2 class="text-xl font-bold text-gray-800 mb-4 text-center">Şehirler</h2>';
            mineralsColumn.innerHTML = '<h2 class="text-xl font-bold text-gray-800 mb-4 text-center">Madenler</h2>';
            const shuffledCitiesData = shuffleArray(gameData.map(item => item.city));
            const shuffledMineralsData = shuffleArray(gameData.map(item => item.mineral));
            shuffledCitiesData.forEach(city => {
                const cityDiv = document.createElement('div');
                cityDiv.classList.add('draggable-item');
                cityDiv.setAttribute('draggable', 'true');
                cityDiv.setAttribute('data-city', city);
                cityDiv.textContent = city;
                cityDiv.id = `city-${city.replace(/\s/g, '-')}`;
                const citySlotDiv = document.createElement('div');
                citySlotDiv.classList.add('city-slot');
                citySlotDiv.id = `city-slot-${city.replace(/\s/g, '-')}`;
                citySlotDiv.setAttribute('data-city-slot-for', city);
                citySlotDiv.appendChild(cityDiv);
                citiesColumn.appendChild(citySlotDiv);
                originalCitySlots.set(cityDiv.id, citySlotDiv);
                cityDiv.addEventListener('dragstart', dragStart);
                citySlotDiv.addEventListener('dragover', dragOver);
                citySlotDiv.addEventListener('dragleave', dragLeave);
                citySlotDiv.addEventListener('drop', drop);
            });
            shuffledMineralsData.forEach(mineral => {
                const mineralDiv = document.createElement('div');
                mineralDiv.classList.add('drop-zone');
                mineralDiv.setAttribute('data-mineral', mineral);
                mineralDiv.id = `mineral-drop-zone-${mineral.replace(/\s/g, '-')}`;
                const mineralNameText = document.createElement('span');
                mineralNameText.classList.add('mineral-name-text');
                mineralNameText.innerHTML = `${mineralIcons[mineral] || ''} ${mineral}`;
                mineralDiv.appendChild(mineralNameText);
                const dropTargetArea = document.createElement('div');
                dropTargetArea.classList.add('drop-zone-target');
                dropTargetArea.id = `drop-target-${mineral.replace(/\s/g, '-')}`;
                mineralDiv.appendChild(dropTargetArea);
                mineralsColumn.appendChild(mineralDiv);
                dropTargetArea.addEventListener('dragover', dragOver);
                dropTargetArea.addEventListener('dragleave', dragLeave);
                dropTargetArea.addEventListener('drop', drop);
            });
            checkButton.classList.remove('hidden');
            checkButton.disabled = false;
            hintButton.classList.remove('hidden');
            playAgainButton.classList.add('hidden');
            gameOverModal.classList.remove('show');
            howToPlayModal.classList.add('show');
        }
        function startGame() {
            gameActive = true;
            clearInterval(timerInterval);
            updateTimerDisplay();
            timerInterval = setInterval(countdown, 1000);
            checkButton.disabled = false;
            howToPlayModal.classList.remove('show');
        }
        function dragStart(e) {
            if (!gameActive) {
                e.preventDefault();
                return;
            }
            e.dataTransfer.setData('text/plain', e.target.id);
            e.target.classList.remove('correct-match', 'incorrect-match');
            setTimeout(() => { e.target.classList.add('opacity-50'); }, 0);
            const previousParent = e.target.parentNode;
            if (previousParent && previousParent.classList.contains('city-slot')) {
                previousParent.classList.add('empty-hidden');
            }
        }
        function dragOver(e) {
            if (!gameActive) {
                e.preventDefault();
                return;
            }
            e.preventDefault();
            const dropTarget = e.target.closest('.drop-zone-target') || e.target.closest('.city-slot');
            if (dropTarget) dropTarget.classList.add('hovered');
        }
        function dragLeave(e) {
            const dropTarget = e.target.closest('.drop-zone-target') || e.target.closest('.city-slot');
            if (dropTarget) dropTarget.classList.remove('hovered');
        }
        function drop(e) {
            if (!gameActive) { e.preventDefault(); return; }
            e.preventDefault();
            const draggedItemId = e.dataTransfer.getData('text/plain');
            const draggedItem = document.getElementById(draggedItemId);
            const dropTarget = e.target.closest('.drop-zone-target') || e.target.closest('.city-slot');
            if (!dropTarget || !draggedItem) return;
            dropTarget.classList.remove('hovered');
            if (draggedItem.parentNode) {
                const previousParent = draggedItem.parentNode;
                previousParent.removeChild(draggedItem);
                if (previousParent.classList.contains('drop-zone-target')) {
                    delete currentMatches[previousParent.id];
                    previousParent.closest('.drop-zone').classList.remove('correct', 'incorrect');
                } else if (previousParent.classList.contains('city-slot')) {
                    previousParent.classList.add('empty-hidden');
                }
            }
            if (dropTarget.classList.contains('drop-zone-target')) {
                if (dropTarget.children.length > 0) {
                    const existingItemInTarget = dropTarget.children[0];
                    const originalSlotForExisting = originalCitySlots.get(existingItemInTarget.id);
                    if (originalSlotForExisting) {
                        originalSlotForExisting.appendChild(existingItemInTarget);
                        existingItemInTarget.classList.remove('correct-match', 'incorrect-match');
                        originalSlotForExisting.classList.remove('empty-hidden');
                    } else {
                        const tempCitySlot = document.createElement('div');
                        tempCitySlot.classList.add('city-slot');
                        tempCitySlot.appendChild(existingItemInTarget);
                        citiesColumn.appendChild(tempCitySlot);
                        existingItemInTarget.classList.remove('correct-match', 'incorrect-match');
                        tempCitySlot.classList.remove('empty-hidden');
                    }
                    delete currentMatches[dropTarget.id];
                }
                dropTarget.appendChild(draggedItem);
                currentMatches[dropTarget.id] = draggedItem.id;
            } else if (dropTarget.classList.contains('city-slot')) {
                if (dropTarget.children.length > 0) {
                    const existingItemInSlot = dropTarget.children[0];
                    const originalSlotForExisting = originalCitySlots.get(existingItemInSlot.id);
                    if (originalSlotForExisting) {
                        originalSlotForExisting.appendChild(existingItemInSlot);
                        existingItemInSlot.classList.remove('correct-match', 'incorrect-match');
                        originalSlotForExisting.classList.remove('empty-hidden');
                    } else {
                        const tempCitySlot = document.createElement('div');
                        tempCitySlot.classList.add('city-slot');
                        tempCitySlot.appendChild(existingItemInSlot);
                        citiesColumn.appendChild(tempCitySlot);
                        existingItemInSlot.classList.remove('correct-match', 'incorrect-match');
                        tempCitySlot.classList.remove('empty-hidden');
                    }
                }
                dropTarget.appendChild(draggedItem);
                dropTarget.classList.remove('empty-hidden');
                for (const targetId in currentMatches) {
                    if (currentMatches[targetId] === draggedItem.id) {
                        document.getElementById(targetId).closest('.drop-zone').classList.remove('correct', 'incorrect');
                        delete currentMatches[targetId];
                        break;
                    }
                }
            }
            draggedItem.classList.remove('opacity-50');
        }
        function updateScoreDisplay() {
            scoreDisplay.textContent = `📝 Deneme: ${trialCount}`;
        }
        function updateIncorrectMatchesDisplay() {
            incorrectMatchesDisplay.textContent = `❌ Yanlış: ${incorrectCount}`;
        }
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerDisplay.textContent = `⏰ Süre: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        function countdown() {
            if (!gameActive) return;
            timeLeft--;
            updateTimerDisplay();
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                endGame(false, true);
            }
        }
        function checkMatches() {
            if (!gameActive) return;
            trialCount++; // her kontrol et'e tıklayınca deneme 1 artar
            updateScoreDisplay();

            score = 0; incorrectCount = 0;
            let playCorrectSound = false, playIncorrectSound = false;
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('correct', 'incorrect');
            });
            document.querySelectorAll('.draggable-item').forEach(item => {
                item.classList.remove('correct-match', 'incorrect-match');
            });
            Object.keys(currentMatches).forEach(dropTargetAreaId => {
                const cityDivId = currentMatches[dropTargetAreaId];
                const dropTargetArea = document.getElementById(dropTargetAreaId);
                const dropZoneParent = dropTargetArea.closest('.drop-zone');
                const cityDiv = document.getElementById(cityDivId);
                const city = cityDiv.getAttribute('data-city');
                const mineral = dropZoneParent.getAttribute('data-mineral');
                const correctPair = gameData.find(data => data.city === city && data.mineral === mineral);
                if (correctPair) {
                    dropZoneParent.classList.add('correct');
                    cityDiv.classList.add('correct-match');
                    score += 10;
                    playCorrectSound = true;
                } else {
                    dropZoneParent.classList.add('incorrect');
                    cityDiv.classList.add('incorrect-match');
                    incorrectCount++;
                    playIncorrectSound = true;
                }
            });
            updateIncorrectMatchesDisplay();
            if (playCorrectSound) correctSynth.triggerAttackRelease('C5', '8n');
            if (playIncorrectSound) incorrectSynth.triggerAttackRelease('F2', '8n');
            const allCitiesPlaced = Object.keys(currentMatches).length === gameData.length;
            if (incorrectCount === 0 && allCitiesPlaced) {
                endGame(true);
            } else {
                endGame(false);
            }
        }
        function endGame(isWin, timeUp = false) {
            gameActive = false;
            clearInterval(timerInterval);
            checkButton.classList.add('hidden');
            checkButton.disabled = true;
            hintButton.classList.add('hidden');
            playAgainButton.classList.remove('hidden');
            if (isWin) {
                modalTitle.textContent = "Tebrikler!";
                modalMessage.textContent = `Tüm eşleşmeleri doğru yaptınız!<br>Toplam Deneme: <b>${trialCount}</b>`;
            } else {
                modalTitle.textContent = "Oyun Bitti!";
                if (timeUp) {
                    modalMessage.innerHTML = `Süreniz doldu!<br>Toplam Deneme: <b>${trialCount}</b><br>Yanlış Eşleşme: <b>${incorrectCount}</b>. Yeniden deneyin!`;
                } else {
                    modalMessage.innerHTML = `Eşleşmeleri kontrol ettiniz.<br>${incorrectCount} yanlış eşleşmeniz var veya tüm şehirleri yerleştirmediniz.<br>Toplam Deneme: <b>${trialCount}</b>. Yeniden deneyin!`;
                }
            }
            gameOverModal.classList.add('show');
        }
        checkButton.addEventListener('click', checkMatches);
        playAgainButton.addEventListener('click', () => { initializeGameElements(); });
        modalPlayAgainButton.addEventListener('click', () => {
            gameOverModal.classList.remove('show');
            initializeGameElements();
        });
        startGameButton.addEventListener('click', () => {
            if (Tone.context.state !== 'running') Tone.start();
            startGame();
        });
        hintButton.addEventListener('click', () => {
            if (gameActive) { hintModal.classList.add('show'); }
        });
        closeHintModalButton.addEventListener('click', () => {
            hintModal.classList.remove('show');
        });
        window.onload = () => { initializeGameElements(); };
    </script>
</body>
</html>
